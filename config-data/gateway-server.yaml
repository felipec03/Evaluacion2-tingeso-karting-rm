// filepath: config-data/gateway-server.yaml
server:
  port: 8085

spring:
  application:
    name: gateway-server
  cloud:
    gateway:
      server:
        webflux:
          routes:
            - id: ms-tarifasconfig
              uri: lb://MS-TARIFASCONFIG # Uppercase
              predicates:
                - Path=/ms-tarifasconfig/**
              filters:
                - StripPrefix=1
            - id: ms-descuentoporpersona
              uri: lb://MS-DESCUENTOPORPERSONA # Uppercase
              predicates:
                - Path=/ms-descuentoporpersona/**
              # No StripPrefix
            - id: ms-descuentosclientefrecuente
              uri: lb://MS-DESCUENTOSCLIENTEFRECUENTE # Uppercase
              predicates:
                - Path=/ms-descuentosclientefrecuente/**
              # No StripPrefix
            - id: ms-tarifadiaespecial
              uri: lb://MS-TARIFADIAESPECIAL # Uppercase
              predicates:
                - Path=/ms-tarifadiaespecial/**
              # No StripPrefix
            - id: ms-registroreserva-comprobantepago # Keep this explicit route
              uri: lb://MS-REGISTRORESERVA-COMPROBANTEPAGO # Uppercase
              predicates:
                - Path=/registroreserva-comprobantepago/**
                - Path=/api/reservas/**                  # This is the one we're testing
                - Path=/api/comprobantes/**
              # NO StripPrefix filter here
            - id: ms-racksemanal
              uri: lb://MS-RACKSEMANAL # Uppercase
              predicates:
                - Path=/ms-racksemanal/**
              # No StripPrefix
            - id: ms-reportes-vueltas-personas
              uri: lb://MS-REPORTES-VUELTAS-PERSONAS # Uppercase
              predicates:
                - Path=/ms-reportes-vueltas-personas/**
              # No StripPrefix
          discovery:
            locator:
              enabled: false # <<<<<< TEMPORARILY DISABLE THIS
              # lower-case-service-id: true # Does not matter if locator is disabled

# Logging configuration
logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    reactor.netty.http.client: DEBUG
    org.springframework.boot.autoconfigure.web.reactive.error: DEBUG

eureka:
  instance:
    prefer-ip-address: true
    instance-id: ${spring.application.name}:${spring.application.instance_id:${random.value}}
  client:
    fetch-registry: true
    register-with-eureka: true
    service-url:
      defaultZone: http://eureka-server-service:8761/eureka/

management:
  endpoints:
    web:
      exposure:
        include: "*" # Adjusted for correct structure
  endpoint:
    health:
      show-details: always